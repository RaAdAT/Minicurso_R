# Bases de Dados

Bases de dados podem ser entendidas como um conjunto de vetores para de mesmo tamanho, em que cada coluna da base de dados é um vetor. No exemplo abaixo é apresentada uma base de dados com três vetores: "Nome", "Idade" e "Mulher", com classes _character_, _numerical_ e _logical_, respectivamente:

| Nome   | Idade | Mulher| 
| -------|:-----:| -----:|
| João   | 27    | FALSE | 
| Ana    | 18    |  TRUE | 
| Luiz   | 21    | FALSE | 
| Carla  | 22    |  TRUE | 
| Pedro  | 35    | FALSE | 

Construindo essa base de dados no R, tem-se:

```{r}
Nome   <- c("João", "Ana", "Luiz", "Carla", "Pedro")
Idade  <- c(27, 18, 21, 22, 35)
Mulher <- c(FALSE, TRUE, FALSE, TRUE, FALSE)

base_de_dados <- data.frame(Nome, Idade, Mulher, stringsAsFactors = FALSE)
print(base_de_dados)
```

Para acessar os antigos vetores criados (agora variáveis da base dados), basta escrever "nome da base de dados"$"nome da variável". Tal sintaxe se deve ao fato de que é possível abrir e manipular diversas bases de dados no R simultaneamente. Um exemplo para o _data.frame_ criado:

```{r}
print(base_de_dados$Nome)
```

## Interação com a base de dados

Há alguns comandos que permitem interagir visualmente com uma base de dados. Por exemplo, _View_ (note a letra maiúscula) mostra a base de dados inteira.

```{r}
View(base_de_dados)
```

A função _head_ apresenta as 6 primeiras linhas da base de dados:

```{r}
head(base_de_dados)
```

A função _tail_ apresenta as 6 últimas linhas da base de dados:

```{r}
tail(base_de_dados)
```

A função _str_ mostra a _classe_ de cada variável:

```{r}
str(base_de_dados)
```

### Argumentos das funções

Tais funções possuem argumentos que podem ser definidos explicitamente. Por exemplo:

```{r}
head(x = base_de_dados, n = 3)
```

Para reportar os argumentos que uma função possui, basta utilizar a função _args_. Para o exemplo acima:

```{r}
args(head)
```

## Abertura de bases de dados no R

Criar bases de dados dentro do R é bem simples, mas de modo geral são importadas bases de dados já criadas que podem estar em diferentes formatos. Serão apresentados a seguir algumas funções do R de **importação de bases de dados**.

### Biblioteca de pacotes _tidyverse_

Até aqui todos os conteúdos apresentados foram baseados na biblioteca de pacotes nativa do R. Daqui em diante, serão utilizadas biblitecas não-nativas. Tal escolha tem uma origem prática: os comandos comumente utilizados para a abertura, manipulação e apresentação de dados no R são da biblioteca do [_tidyverse_](http://tidyverse.org/).

Vale, portanto, instalar e carregar desde já essa biblioteca:

```{r}
install.packages("tidyverse") 
library(tidyverse)
```
Note que o pacote _tidyverse_ carrega, na verdade, um conjunto de pacotes: _dplyr_, _ggplot2_, _readr_, dentre outros. Os comandos utilizados daqui para frente serão baseados neles.

### Importação de dados com _tidyverse_

Há dois pacotes que armazenam funções de importação dentro do _tidyverse_: o **_readr_** e o **_readxl_**. Os nomes das funções varia de acordo com a extensão do arquivo.

O **_readr_** é reponsável pela leitura de arquivos em formato "retangular" (csv, txt, etc.). Algumas de suas funções são:

- **_read_csv( )_**: arquivos csv (comma separated files)
- **_read_tsv( )_**: arquivos separados por tab
- **_read_delim( )_**: arquivos com delimitador genérico
- **_read_fwf( )_**: arquivos de largura fixa
- **_read_table( )_**: arquivos de tabulação em que as colunas são separadas por espaço em branco
- **_read_log( )_**: arquivos em formato web log (registros de atividade de servidores)

O **_readxl_** é um pacote específico para abrir arquivos em formato .xls ou .xlsx, tipicamente do Microsoft Excel. Sua função é:

- **_read_excel()_**: arquivos xls ou xlsx

Para fins do minicurso, será utilizado um exemplo com um arquivo .csv, mas o exemplo é facilmente transbordado para outras extensões. Os dados estão disponíveis no próprio repositório.

### Baixando dados da internet

O _link_ para os dados da 

Eis o exemplo, com dados da Pesquisa de Informações Básicas Municipais (MUNIC) de 2015:

read_delim(file1, delim = ",", col_types = "cicid")



## Manipulação de dados com o tidyverse

A manipulação de dados dentro do _tidyverse_ é feita com o pacote _dplyr_. Há cinco funções principais, que podem ser combinadas com diversas funções já existentes no R:

- **_mutate( )_**: adiciona novas variáveis como função das existentes (ou muda a própria variável)
- **_select( )_**: seleciona variáveis (colunas) com base em seus nomes
- **_filter( )_**: filtra observações (linhas) com base em seus valores
- **_summarise( )_**: reduz valores das observações a estatísticas
- **_arrange( )_**: muda a ordem das observações na base


